---
title: "AF_Correlation_Regression_Modeling_4.4.18"
author: "cmosle1"
date: "4/4/2018"
output: html_document
---

```{r}
#data import. 

AFdata<- read.csv("~/Desktop/Modeling Literature/AF_US_UNI_AllSubsSurvey+Audio_2.20.18.csv", header=T, na.strings="#NULL!")
#head(AFdata)
#View(AFdata)

library("dplyr")
library("tidyr")
library("ggplot2")
library('caTools')
library("Hmisc")
```


#Changing "90NR" and "9999" to "95"; Copied from previous code (AF_MI1_3.9.18.rmd)
```{r}

#issue with 90NR --> 95 change: the HHT doesn't measure other thresholds if 90NR at 1000Hz (first threshold tested). Should we set all thresholds to 95 or leave them missing? ---> SOLUTION: SET ALL >90 to 95

#Changing 90NR (aka 9999) and Conventional audio thresholds that are > 90 to 95

#Left Ear
AFdata$L5<-AFdata$L500
AFdata$L5[AFdata$L500 > 90] <- 95
AFdata$L1<-AFdata$L1000
AFdata$L1[AFdata$L1000 > 90] <- 95
AFdata$L2<-AFdata$L2000
AFdata$L2[AFdata$L2000 > 90] <- 95
AFdata$L4<-AFdata$L4000
AFdata$L4[AFdata$L4000 > 90] <- 95


#Right Ear
AFdata$R5<-AFdata$R500
AFdata$R5[AFdata$R500 > 90] <- 95
AFdata$R1<-AFdata$R1000
AFdata$R1[AFdata$R1000 > 90] <- 95
AFdata$R2<-AFdata$R2000
AFdata$R2[AFdata$R2000 > 90] <- 95
AFdata$R4<-AFdata$R4000
AFdata$R4[AFdata$R4000 > 90] <- 95

#At 8000Hz
AFdata$L8<-AFdata$L8000
AFdata$L8[AFdata$L8000 > 90] <- 95
AFdata$R8<-AFdata$R8000
AFdata$R8[AFdata$R8000 > 90] <- 95
```


# Creating PTA Values (L, R, & BE); Copied from previous code (AF_MI1_3.9.18.rmd)
```{r}
# Calculating PTA in each ear

#colnames(AFdata[,1000:1021])
AFdata$LPTA <- apply(AFdata[,1011:1014], 1, mean, na.rm=T)
AFdata$RPTA <- apply(AFdata[,1015:1018], 1, mean, na.rm=T)


AFdata$LPTA[is.nan(AFdata$LPTA)]  <- NA
AFdata$RPTA[is.nan(AFdata$RPTA)]  <- NA

#Now can calculate BEPTA (PTA in better ear)
AFdata$BEPTA<- ifelse((!is.na(AFdata$RPTA) & AFdata$RPTA <= AFdata$LPTA) | is.na(AFdata$LPTA),
                      AFdata$RPTA, AFdata$LPTA)
#To Check
#AFdata[c(1,2,257),c("RPTA", "LPTA", "BEPTA")] 
#is.na(AFdata$BEPTA)
#AFdata[which(is.na(AFdata$RPTA)), c("RPTA", "LPTA", "BEPTA")]
```



#Reducing size of dataset
```{r}
abbrev.data <- select(AFdata , c("q0002", "q0003", "q0005", "q0008", "q0010", "q0012", "q0013", "q0014", "q0032", "q0034", "q0036", "q0042", "q0046", "BEPTA"))
```


#Correlation Matrix using Pearson's r & sig levels
```{r}
AFcorr1 <- rcorr(as.matrix(abbrev.data))
AFcorr1
```

## Variables significantly correlated with BEPTA include:
   q0002  q0003 q0008 q0012  q0013 q0032 q0042  q0046

## Ranked by magnitude of correlation
   q0046, q0032, q0042, q0003, q0013, q0012, q0002, q0008




#Splitting sample

```{r}
set.seed(4) 
samp.split1 <- sample.split(AFdata$q0001, SplitRatio = .5)
temp_mangroup <- subset(AFdata, samp.split1 == TRUE)
testgroup  <- subset(AFdata, samp.split1 == FALSE)
mangroup<-drop_na(temp_mangroup, c('BEPTA'))
dim(mangroup) # n=248
dim(testgroup) # n=261
is.na(mangroup$BEPTA) #No missing PTA values
identical(migroup, mangroup) #Shows me that this group is different from the one I used in my Amelia model
```


#Parsing down split sample
```{r}
man.group1 <- select(mangroup , c("q0002", "q0003", "q0005", "q0008", "q0010", "q0012", "q0013", "q0014", "q0032", "q0034", "q0036", "q0042", "q0046", "BEPTA"))

```

# Starting forward selection process (FS)

```{r}
fs1<- lm(BEPTA~q0046, data=man.group1)
summary(fs1)

fs2<- lm(BEPTA ~ q0046 + q0032, data=man.group1)
summary(fs2)

```

